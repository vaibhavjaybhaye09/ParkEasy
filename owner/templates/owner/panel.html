{% extends 'base.html' %}
{% block title %}Owner Panel{% endblock %}
{% block content %}
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #f4f6f9;
    }
    .sidebar {
        background: #1a3c6c;
        color: #ffffff;
        padding-top: 1.5rem;
    }
    .sidebar-header {
        text-align: center;
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .sidebar-header h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
        color: #ffffff;
    }
    .sidebar-nav {
        list-style: none;
        padding: 0;
        margin-top: 1.5rem;
    }
    .sidebar-nav li {
        margin-bottom: 0.5rem;
    }
    .sidebar-nav a {
        display: flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        color: #d1d5db;
        text-decoration: none;
        font-size: 1.1rem;
        transition: background 0.2s ease, color 0.2s ease;
    }
    .sidebar-nav a:hover, .sidebar-nav a.active {
        background: #2c5282;
        color: #ffffff;
        border-radius: 8px;
    }
    .sidebar-nav a i {
        margin-right: 0.75rem;
    }
    .main-content {
        padding: 1rem 0;
        min-height: auto;
    }
    .content-section {
        display: none;
        background: #ffffff;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    .content-section.active {
        display: block;
    }
    .dashboard-table th {
        background: #e9ecef;
        color: #1a3c6c;
        font-weight: 600;
    }
    .dashboard-table td {
        color: #374151;
    }
    .action-links a {
        color: #2563eb;
        text-decoration: none;
        font-weight: 500;
        margin-right: 1rem;
        transition: color 0.2s ease;
    }
    .action-links a:hover {
        color: #1a3c6c;
        text-decoration: underline;
    }
    .btn-primary {
        background-color: #1a3c6c;
        border-color: #1a3c6c;
        padding: 0.5rem 1.5rem;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .btn-primary:hover {
        background-color: #2c5282;
        border-color: #2c5282;
        transform: translateY(-2px);
    }
    .btn-outline-primary {
        border-color: #1a3c6c;
        color: #1a3c6c;
        padding: 0.5rem 1.5rem;
        font-weight: 500;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .btn-outline-primary:hover {
        background-color: #1a3c6c;
        color: #ffffff;
        transform: translateY(-2px);
    }
    @media (max-width: 768px) {
        .sidebar {
            width: 70px;
        }
        .sidebar-nav a span {
            display: none;
        }
        .main-content {
            margin-left: 70px;
        }
        .sidebar-header h3 {
            font-size: 1.2rem;
        }
    }
    @media (max-width: 576px) {
        .sidebar {
            width: 100%;
            height: auto;
            position: relative;
            top: 0;
        }
        .main-content {
            margin-left: 0;
            margin-top: 0;
        }
        .btn-primary, .btn-outline-primary {
            width: 100%;
            text-align: center;
        }
    }
</style>

<div class="container-fluid">
	<div class="row">
		<div class="col-md-3">
			<div class="sidebar">
				<div class="sidebar-header">
					<h3><i class="fas fa-user-cog me-2"></i> Owner Dashboard</h3>
				</div>
				<ul class="sidebar-nav px-3">
					<li><a href="#profile" class="nav-link active" data-section="profile"><i class="fas fa-id-card"></i> <span>Your Profile</span></a></li>
					<li><a href="#stats" class="nav-link" data-section="stats"><i class="fas fa-chart-bar"></i> <span>Statistics</span></a></li>
					<li><a href="#places" class="nav-link" data-section="places"><i class="fas fa-parking"></i> <span>Your Parking Places</span></a></li>
					<li><a href="#booked" class="nav-link" data-section="booked"><i class="fas fa-car"></i> <span>Booked Slots</span></a></li>
				</ul>
			</div>
		</div>
		<div class="col-md-9">
			<div class="main-content">
				<div class="container-fluid">
					<div class="content-section active" id="profile">
						<h3><i class="fas fa-id-card me-2"></i> Your Profile</h3>
						<p>Welcome, <strong>{{ user.username }}</strong>!</p>
						{% if profile.phone or profile.address %}
							<p><strong>Name:</strong> {{ profile.username }}</p>
							<p><strong>Email:</strong> {{ profile.email }}</p>
							<p><strong>Phone:</strong> {{ profile.phone|default:'-' }}</p>
							<p><strong>Address:</strong> {{ profile.address|default:'-' }}</p>
							<a href="{% url 'owner_profile_edit' %}" class="btn btn-outline-primary mt-3"><i class="fas fa-edit me-2"></i> Edit Profile</a>
						{% else %}
							<p class="text-muted">No profile details yet.</p>
							<a href="{% url 'owner_profile_edit' %}" class="btn btn-primary mt-3"><i class="fas fa-user-plus me-2"></i> Create Profile</a>
						{% endif %}
					</div>

					<div class="content-section" id="stats">
						<h3><i class="fas fa-chart-bar me-2"></i> Statistics</h3>
						<div class="row">
							<div class="col-md-3">
								<div class="card text-center">
									<div class="card-body">
										<h5 class="card-title">Total Places</h5>
										<p class="card-text display-6">{{ total_places }}</p>
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="card text-center">
									<div class="card-body">
										<h5 class="card-title">Total Slots</h5>
										<p class="card-text display-6">{{ total_slots }}</p>
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="card text-center">
									<div class="card-body">
										<h5 class="card-title">Booked Slots</h5>
										<p class="card-text display-6">{{ booked_slots }}</p>
									</div>
								</div>
							</div>
							<div class="col-md-3">
								<div class="card text-center">
									<div class="card-body">
										<h5 class="card-title">Available</h5>
										<p class="card-text display-6">{{ total_slots|add:"-"|add:booked_slots }}</p>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="content-section" id="places">
						<div class="d-flex justify-content-between align-items-center mb-3">
							<h3><i class="fas fa-parking me-2"></i> Your Parking Places</h3>
							<a href="{% url 'owner_add_place' %}" class="btn btn-primary"><i class="fas fa-plus-circle me-2"></i> Add New Place</a>
						</div>
						{% if places %}
							<div class="table-responsive">
								<table class="table dashboard-table">
									<thead>
										<tr>
											<th scope="col">Name</th>
											<th scope="col">City</th>
											<th scope="col">Area</th>
											<th scope="col">Price/hr</th>
											<th scope="col">Allowed Vehicle Types</th>
											<th scope="col">Actions</th>
										</tr>
									</thead>
									<tbody>
										{% for p in places %}
										<tr>
											<td>{{ p.name }}</td>
											<td>{{ p.city }}</td>
											<td>{{ p.area|default:'-' }}</td>
											<td>â‚¹{{ p.price_per_hour }}</td>
											<td>
												{% if p.allowed_vehicle_types %}
													{{ p.allowed_vehicle_types|join:", " }}
												{% else %}-{% endif %}
											</td>
											<td class="action-links">
												<a href="{% url 'owner_edit_place' p.id %}"><i class="fas fa-edit me-1"></i> Edit</a>
												<a href="{% url 'owner_delete_place' p.id %}"><i class="fas fa-trash-alt me-1"></i> Delete</a>
												<a href="{% url 'owner_slots' p.id %}"><i class="fas fa-car-side me-1"></i> Slots</a>
											</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						{% else %}
							<p class="text-muted my-3">No places yet.</p>
							<a href="{% url 'owner_add_place' %}" class="btn btn-primary"><i class="fas fa-plus-circle me-2"></i> Add First Place</a>
						{% endif %}
					</div>

					<div class="content-section" id="booked">
						<div class="d-flex justify-content-between align-items-center mb-3">
							<h3><i class="fas fa-car me-2"></i> Recent Bookings</h3>
							<a href="{% url 'owner_booked_slots' %}" class="btn btn-outline-primary">View All Booked Slots</a>
						</div>
						{% if recent_bookings %}
							<div class="table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>Customer</th>
											<th>Place</th>
											<th>Slot</th>
											<th>Vehicle</th>
											<th>Start Time</th>
											<th>End Time</th>
											<th>Status</th>
										</tr>
									</thead>
									<tbody>
										{% for booking in recent_bookings %}
										<tr>
											<td>{{ booking.customer.username }}</td>
											<td>{{ booking.slot.place.name }}</td>
											<td>{{ booking.slot.code }}</td>
											<td>
												<small class="text-muted">{{ booking.get_vehicle_type_display }}</small><br>
												<strong>{{ booking.vehicle_number_plate }}</strong>
											</td>
											<td>{{ booking.start_time|date:"M d, H:i" }}</td>
											<td>{{ booking.end_time|date:"M d, H:i" }}</td>
											<td>
												{% if booking.status == 'pending' %}
													<span class="badge bg-warning">Pending</span>
												{% elif booking.status == 'active' %}
													<span class="badge bg-success">Active</span>
												{% elif booking.status == 'completed' %}
													<span class="badge bg-secondary">Completed</span>
												{% else %}
													<span class="badge bg-danger">{{ booking.status|title }}</span>
												{% endif %}
											</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						{% else %}
							<p class="text-muted">No bookings at the moment.</p>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	// Limit tab behavior to sidebar links only so navbar links (Home, etc.) work normally
	Array.prototype.slice.call(document.querySelectorAll('.sidebar-nav .nav-link')).forEach(function(link){
		link.addEventListener('click', (e) => {
			e.preventDefault();
			Array.prototype.slice.call(document.querySelectorAll('.sidebar-nav .nav-link')).forEach(function(nav){ nav.classList.remove('active'); });
			link.classList.add('active');
			Array.prototype.slice.call(document.querySelectorAll('.content-section')).forEach(function(section){ section.classList.remove('active'); });
			const sectionId = link.getAttribute('data-section');
			const target = document.getElementById(sectionId);
			if (target) {
				target.classList.add('active');
			}
		});
	});
</script>
{% endblock %}
